<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <title>PBS/Torque &middot; Funnel</title>
  

  
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/poole.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/darcula.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/syntax.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/theme.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/funnel.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://ohsu-comp-bio.github.io/funnel/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://ohsu-comp-bio.github.io/funnel/favicon.png">

  <script src="https://ohsu-comp-bio.github.io/funnel/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>

  <div class="global-header">
    <div class="global-header-container">
      <div class="global-header-home">
        <a href="https://ohsu-comp-bio.github.io/funnel/"><h1>Funnel</h1></a>
      </div>
      <ul class="global-header-nav">
          <li><a href="https://ohsu-comp-bio.github.io/funnel/download/">Download</a></li>
          <li><a href="https://ohsu-comp-bio.github.io/funnel/docs/">Docs</a></li>
          <li><a href="https://github.com/ohsu-comp-bio/funnel">GitHub</a></li>
          <li><a href="https://gitter.im/ohsu-comp-bio/funnel">Chat</a></li>
          <li><a href="https://ohsu-comp-bio.github.io/funnel-compliance/">Compliance</a></li>
        </ul>
      <div class="global-header-ohsucb">
        <a href="https://www.ohsu.edu/xd/education/schools/school-of-medicine/departments/computational-biology/"><h2>OHSU Comp Bio</h2></a>
      </div>
    </div>
  </div>


<div class="content section group">

  <div class="sidebar col span_3_of_12">
    <ul class="sidebar-nav">
      
      
        
        <li>
          
          <a href="https://ohsu-comp-bio.github.io/funnel/download/"
             class="sidebar-nav-item "
          >Download</a></li>
          
        
        <li>
          
          <a href="https://ohsu-comp-bio.github.io/funnel/docs/"
             class="sidebar-nav-item "
          >Overview</a></li>
          
        
        <li>
          
          <a href="https://ohsu-comp-bio.github.io/funnel/docs/tasks/"
             class="sidebar-nav-item "
          >Tasks</a></li>
          
        
        <li>
          
          <span class="intermediate">Storage</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/local/"
                   class="sidebar-nav-item "
                >Local</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/ftp/"
                   class="sidebar-nav-item "
                >FTP</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/google-storage/"
                   class="sidebar-nav-item "
                >Google Storage</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/http/"
                   class="sidebar-nav-item "
                >HTTP(S)</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/swift/"
                   class="sidebar-nav-item "
                >OpenStack Swift</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/s3/"
                   class="sidebar-nav-item "
                >S3</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Compute</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/deployment/"
                   class="sidebar-nav-item "
                >Deploying a cluster</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/aws-batch/"
                   class="sidebar-nav-item "
                >AWS Batch</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/grid-engine/"
                   class="sidebar-nav-item "
                >Grid Engine</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/htcondor/"
                   class="sidebar-nav-item "
                >HTCondor</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/kubernetes/"
                   class="sidebar-nav-item "
                >Kubernetes</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/pbs-torque/"
                   class="sidebar-nav-item  active"
                >PBS/Torque</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/slurm/"
                   class="sidebar-nav-item "
                >Slurm</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Databases</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/boltdb/"
                   class="sidebar-nav-item "
                >Embedded</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/datastore/"
                   class="sidebar-nav-item "
                >Datastore</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/dynamodb/"
                   class="sidebar-nav-item "
                >DynamoDB</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/elasticsearch/"
                   class="sidebar-nav-item "
                >Elasticsearch</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/mongodb/"
                   class="sidebar-nav-item "
                >MongoDB</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Events</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/events/kafka/"
                   class="sidebar-nav-item "
                >Kafka</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Metrics</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/metrics/prometheus/"
                   class="sidebar-nav-item "
                >Prometheus</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Security</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/security/basic/"
                   class="sidebar-nav-item "
                >Basic Auth</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Development</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/development/developers/"
                   class="sidebar-nav-item "
                >Funnel Developers</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://godoc.org/github.com/ohsu-comp-bio/funnel"
                   class="sidebar-nav-item "
                >Reference</a></li>
            </ul>
          </li>
          
          
        
      
    </ul>
  </div>

  <div class="main col span_8_of_12">
    <h1 id="pbstorque">PBS/Torque</h1>
<p>Funnel can be configured to submit workers to <a href="http://www.adaptivecomputing.com/products/open-source/torque/">PBS/Torque</a> by making calls
to <code>qsub</code>.</p>
<p>The Funnel server needs to run on a submission node.
Configure Funnel to use PBS by including the following config:</p>
<p>It is recommended to update the submit file template so that the
<code>funnel worker run</code> command takes a config file as an argument
(e.g. <code>funnel worker run --config /opt/funnel_config.yml --taskID {{.TaskId}}</code>)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#ae81ff">Compute: pbs

PBS:
    Template: |<p style="margin-left: 3em">#!/bin/bash
#PBS -N {{.TaskId}}
#PBS -o {{.WorkDir}}/funnel-stdout
#PBS -e {{.WorkDir}}/funnel-stderr
{{if ne .Cpus 0 -}}
{{printf &#34;#PBS -l nodes=1:ppn=%d&#34; .Cpus}}
{{- end}}
{{if ne .RamGb 0.0 -}}
{{printf &#34;#PBS -l mem=%.0fgb&#34; .RamGb}}
{{- end}}
{{if ne .DiskGb 0.0 -}}
{{printf &#34;#PBS -l file=%.0fgb&#34; .DiskGb}}
{{- end}}

funnel worker run --taskID {{.TaskId}}
</p>
</span>
</span></span></code></pre></div><p>The following variables are available for use in the template:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Variable</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">TaskId</td>
<td style="text-align:left">funnel task id</td>
</tr>
<tr>
<td style="text-align:left">WorkDir</td>
<td style="text-align:left">funnel working directory</td>
</tr>
<tr>
<td style="text-align:left">Cpus</td>
<td style="text-align:left">requested cpu cores</td>
</tr>
<tr>
<td style="text-align:left">RamGb</td>
<td style="text-align:left">requested ram</td>
</tr>
<tr>
<td style="text-align:left">DiskGb</td>
<td style="text-align:left">requested free disk space</td>
</tr>
<tr>
<td style="text-align:left">Zone</td>
<td style="text-align:left">requested zone (could be used for queue name)</td>
</tr>
</tbody>
</table>
<p>See <a href="https://golang.org/pkg/text/template">https://golang.org/pkg/text/template</a> for information on creating templates.</p>

  </div>

</div>
</body>
</html>
