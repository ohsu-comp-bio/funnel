<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <title>Funnel Developers &middot; Funnel</title>
  

  
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/poole.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/darcula.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/syntax.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/theme.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/funnel.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://ohsu-comp-bio.github.io/funnel/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://ohsu-comp-bio.github.io/funnel/favicon.png">

  <script src="https://ohsu-comp-bio.github.io/funnel/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>

  <div class="global-header">
    <div class="global-header-container">
      <div class="global-header-home">
        <a href="https://ohsu-comp-bio.github.io/funnel/"><h1>Funnel</h1></a>
      </div>
      <ul class="global-header-nav">
          <li><a href="https://ohsu-comp-bio.github.io/funnel/download/">Download</a></li>
          <li><a href="https://ohsu-comp-bio.github.io/funnel/docs/">Docs</a></li>
          <li><a href="https://github.com/ohsu-comp-bio/funnel">GitHub</a></li>
          <li><a href="https://gitter.im/ohsu-comp-bio/funnel">Chat</a></li>
          <li><a href="https://ohsu-comp-bio.github.io/funnel-compliance/">Compliance</a></li>
        </ul>
      <div class="global-header-ohsucb">
        <a href="https://www.ohsu.edu/xd/education/schools/school-of-medicine/departments/computational-biology/"><h2>OHSU Comp Bio</h2></a>
      </div>
    </div>
  </div>


<div class="content section group">

  <div class="sidebar col span_3_of_12">
    <ul class="sidebar-nav">
      
      
        
        <li>
          
          <a href="https://ohsu-comp-bio.github.io/funnel/download/"
             class="sidebar-nav-item "
          >Download</a></li>
          
        
        <li>
          
          <a href="https://ohsu-comp-bio.github.io/funnel/docs/"
             class="sidebar-nav-item "
          >Overview</a></li>
          
        
        <li>
          
          <a href="https://ohsu-comp-bio.github.io/funnel/docs/tasks/"
             class="sidebar-nav-item "
          >Tasks</a></li>
          
        
        <li>
          
          <span class="intermediate">Storage</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/local/"
                   class="sidebar-nav-item "
                >Local</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/ftp/"
                   class="sidebar-nav-item "
                >FTP</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/google-storage/"
                   class="sidebar-nav-item "
                >Google Storage</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/http/"
                   class="sidebar-nav-item "
                >HTTP(S)</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/swift/"
                   class="sidebar-nav-item "
                >OpenStack Swift</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/storage/s3/"
                   class="sidebar-nav-item "
                >S3</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Compute</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/deployment/"
                   class="sidebar-nav-item "
                >Deploying a cluster</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/aws-batch/"
                   class="sidebar-nav-item "
                >AWS Batch</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/grid-engine/"
                   class="sidebar-nav-item "
                >Grid Engine</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/htcondor/"
                   class="sidebar-nav-item "
                >HTCondor</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/kubernetes/"
                   class="sidebar-nav-item "
                >Kubernetes</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/pbs-torque/"
                   class="sidebar-nav-item "
                >PBS/Torque</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/compute/slurm/"
                   class="sidebar-nav-item "
                >Slurm</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Databases</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/boltdb/"
                   class="sidebar-nav-item "
                >Embedded</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/datastore/"
                   class="sidebar-nav-item "
                >Datastore</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/dynamodb/"
                   class="sidebar-nav-item "
                >DynamoDB</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/elasticsearch/"
                   class="sidebar-nav-item "
                >Elasticsearch</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/databases/mongodb/"
                   class="sidebar-nav-item "
                >MongoDB</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Events</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/events/kafka/"
                   class="sidebar-nav-item "
                >Kafka</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Metrics</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/metrics/prometheus/"
                   class="sidebar-nav-item "
                >Prometheus</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Security</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/security/basic/"
                   class="sidebar-nav-item "
                >Basic Auth</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate">Development</span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/development/developers/"
                   class="sidebar-nav-item  active"
                >Funnel Developers</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://godoc.org/github.com/ohsu-comp-bio/funnel"
                   class="sidebar-nav-item "
                >Reference</a></li>
            </ul>
          </li>
          
          
        
      
    </ul>
  </div>

  <div class="main col span_8_of_12">
    <h1 id="developers">Developers</h1>
<p>This page contains a rough collection of notes for people wanting to build Funnel from source and/or edit the code.</p>
<h3 id="building-the-funnel-source">Building the Funnel source</h3>
<ol>
<li>
<p>Install <a href="https://golang.org">Go 1.11+</a>. Check the version with <code>go version</code>.</p>
</li>
<li>
<p>Ensure GOPATH is set. See <a href="https://golang.org/doc/code.html#GOPATH">the docs</a> for help. Also, you probably want to add <code>$GOPATH/bin</code> to your <code>PATH</code>.</p>
</li>
<li>
<p>Clone funnel and build</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/ohsu-comp-bio/funnel.git
</span></span><span style="display:flex;"><span>$ cd funnel
</span></span><span style="display:flex;"><span>$ make
</span></span></code></pre></div></li>
<li>
<p>Funnel is now downloaded and installed. Try <code>funnel version</code>.</p>
</li>
<li>
<p>You can edit the code and run <code>make install</code> to recompile.</p>
</li>
</ol>
<h3 id="developer-tools">Developer Tools</h3>
<p>A Funnel development environment includes:</p>
<ul>
<li><a href="https://golang.org">Go 1.11+</a> for the majority of the code.</li>
<li><a href="https://github.com/ga4gh/task-execution-schemas">Task Execution Schemas</a> for task APIs.</li>
<li><a href="https://github.com/google/protobuf">Protobuf</a> + <a href="http://www.grpc.io/">gRPC</a> for RPC communication.</li>
<li><a href="https://github.com/grpc-ecosystem/grpc-gateway">gRPC Gateway</a> for HTTP communication.</li>
<li><a href="https://angularjs.org/">Angular</a> and <a href="http://sass-lang.com/">SASS</a> for the web dashboard.</li>
<li><a href="https://www.gnu.org/software/make/">GNU Make</a> for development tasks.</li>
<li><a href="https://docker.io">Docker</a> for executing task containers (tested with v1.12, v1.13).</li>
<li><a href="https://golang.github.io/dep/">dep</a> for Go dependency vendoring.</li>
<li><a href="https://www.gnu.org/software/make/">Make</a> for development/build commands.</li>
<li><a href="https://nodejs.org">NodeJS</a> and <a href="https://www.npmjs.com/">NPM</a> for web dashboard development.</li>
</ul>
<h3 id="makefile">Makefile</h3>
<p>Most development tasks are run through <code>make</code> commands, including build, release, testing, website docs, lint, tidy, webdash dev, and more.  See the <a href="https://github.com/ohsu-comp-bio/funnel/blob/master/Makefile">Makefile</a> for an up-to-date list of commands.</p>
<h3 id="go-tests">Go Tests</h3>
<p>Run all tests: <code>make test</code><br>
Run the worker tests: <code>go test ./worker/...</code><br>
Run the worker tests with &ldquo;Cancel&rdquo; in the name: <code>go test ./worker -run Cancel</code></p>
<p>You get the idea. See the <code>go test</code> docs for more.</p>
<h3 id="mocking">Mocking</h3>
<p>The <a href="https://github.com/stretchr/testify">testify</a> and <a href="https://github.com/vektra/mockery">mockery</a> tools are used to generate and use
mock interfaces in test code, for example, to mock the Google Cloud APIs.</p>
<h3 id="making-a-release">Making a release</h3>
<ul>
<li>Update Makefile, edit <code>FUNNEL_VERSION</code> and <code>LAST_PR_NUMBER</code>
<ul>
<li><code>LAST_PR_NUMBER</code> can be found by looking at the previous release notes
from the previous release.</li>
</ul>
</li>
<li>Run <code>make website</code>, which updates the download links and other content.
<ul>
<li>Check the website locally by running <code>make website-dev</code></li>
</ul>
</li>
<li>Commit these changes.
<ul>
<li>Because goreleaser requires a clean working tree in git</li>
<li>This is a special case where it&rsquo;s easiest to commit to master.</li>
</ul>
</li>
<li>Create a git tag: <code>git tag X.Y.Z</code></li>
<li>Run <code>make release</code>
<ul>
<li>This will build cross-platform binaries, build release notes,
and draft an unpublished GitHub release.</li>
<li>Check the built artifacts by downloading the tarballs from the GitHub draft release
and running <code>funnel version</code>.</li>
</ul>
</li>
<li><code>git push origin master</code> to push your website and release changes.</li>
<li>A tagged docker image for the release will be built automatically on <a href="https://hub.docker.com/repository/docker/ohsucompbio/funnel">dockerhub</a>.</li>
<li>Publish the draft release on GitHub.</li>
<li>Copy <code>build/release/funnel.rb</code> to the <code>ohsu-comp-bio/homebrew-formula/Formula/funnel.rb</code> Homebrew formula repo, and push those changes to master.</li>
</ul>

  </div>

</div>
</body>
</html>
